<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title> The Pine A64 is about to become the cheapest ARM 64-bit platform to run Docker &middot; Docker Pirates ARMed with explosive stuff </title>

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/hyde.css">
  <link rel="stylesheet" href="/css/hypriot.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.ico">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Docker Pirates ARMed with explosive stuff" />
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-59194692-1', 'auto');
    ga('send', 'pageview');

  </script>

</head>

<body>

<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-logo">
      <a href="/"><img src="/images/logo_tr.png" /></a>
    </div>
    <div class="sidebar-about">
      <h1><a href="/">Docker Pirates ARMed with explosive stuff</a></h1>
      <p class="lead">
       Roaming the seven seas in search for golden container plunder. 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="/">HOME</a> </li>
      
        <li><a href="/getting-started-with-docker-on-your-arm-device/"> GETTING STARTED </a></li>
      
        <li><a href="/downloads/"> DOWNLOADS </a></li>
      
        <li><a href="/faq/"> FAQ </a></li>
      
        <li><a href="https://gitter.im/hypriot/talk"> COMMUNITY </a></li>
      
        <li><a href="/about/"> ABOUT US </a></li>
      
        <li><a href="/crew/"> CREW </a></li>
      
    </ul>

    <p>&copy; 2016 Hypriot </p>
    <p><a href="/legal_notice" style="font-size: 1rem;">Legal Notice</a></p>
    <div class="edit-github" id="edit-github-id">
        <p>
          <a href="https://github.com/hypriot/blog"><img src="https://www.presidecms.com/assets/img/icons/github.png" style="float:left; width:9%; height:9%; padding-right: 8px; padding-top: 6px; align: center; ">Edit this blog on GitHub</img></a>
        </p>
    </div>
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1>The Pine A64 is about to become the cheapest ARM 64-bit platform to run Docker</h1>
    <span class="post-date">Mon, Jan 25, 2016</span>
    

<p><img src="/images/pine-a64/close_up_front_pine_06.jpg" alt="" /></p>

<p>Last Saturday one of the more promising <a href="https://www.kickstarter.com/projects/pine64/pine-a64-first-15-64-bit-single-board-super-comput">Kickstarter campaigns</a>
that piqued our curiosity ended after 44 days and was able to raise <strong>1.7 million dollars</strong>.
It was a campaign to fund the cheapest 64-bit ARM board that can currently be bought for money.</p>

<p><strong>The Pine A64 sells for 15 bucks</strong>.</p>

<p>So why is that noteworthy when there are boards like the Pi Zero around that sell for $5?</p>

<p>It very much is, when you put that price into perspective. The cheapest 64-bit ARM board we knew before the Pine was
the <a href="http://blog.hypriot.com/post/getting-docker-running-on-a-highend-arm-gaming-console-for-fun-and-profit/">NVIDIA ShieldTV</a>, which sells for about $200.
Next comes the much more expensive <a href="http://www.slashgear.com/amd-starts-shipping-seattle-arm-server-chips-14423259/">AMD Opteron A1100 series</a> where an individual chip alone starts with a price tag of $150.</p>

<p>All in all that means that the Pine A64 is the most affordable way to lay your hands on real 64-bit ARM hardware - and that by a long shot!
So what can you actually do with such a device?</p>

<p>Lots of things of course, but <strong>for us at Hypriot, the first thing we think about anything is: Can we run Docker on it?</strong>
And the short answer is: probably yes. But more about that later.</p>

<h2 id="the-hardware:7983295b98b0feead04ba41a7de6ce9d">The Hardware</h2>

<p>Before we deep dive into the nitty gritty details, let&rsquo;s first take a step back and see what the Pine A64 has to offer hardware-wise.</p>

<p>The Pine A64 does have</p>

<ul>
<li>a <strong>quad-core Cortex A53 CPU</strong> with 1,2 Ghz</li>
<li>a <strong>64-bit</strong> processor architecture</li>
<li>up to <strong>2 GB of DDR3 memory</strong></li>
<li>a version with <strong>Gigabit Ethernet</strong></li>
<li>the ability to play 4K video</li>
</ul>

<p>What excites us the most here, is the 64-bit architecture combined with 2 GB of memory and Gigabit Ethernet.</p>

<p>Those specs set the Pine A64 distinctly apart from the Raspberry Pi 2, which much to our regret only provides 100 Megabit Ethernet.
Just be aware that you&rsquo;ll get these specs only with the high-end version of the Pine. It is called the A64+ and costs a bit more with $19 (1 GB version) or $29 (2 GB version).
<strong>Even at $19 for the 1 GB version that&rsquo;s nearly half of the price of a Raspberry Pi 2.</strong></p>

<p>If it turns out that the build quality and support of the board is on par with that of the Raspberry Pi that could indeed considered an impressive accomplishment.</p>

<p>We were lucky enough to secure an early developer version of the device, which arrived a couple of days ago.
Seeing is believing and as such we prepared a couple of photos that we made from our own Pine A64+ board with 1 GB.</p>

<p><div class="gallery clearfix" itemscope itemtype="http://schema.org/ImageGallery">





<figure itemscope itemtype="http://schema.org/ImageObject">
  <a href="/images/pine-a64-gallery/close_up_front_pine_06.jpg" itemprop="contentUrl" data-size="1000x664">
      <img src="/images/pine-a64-gallery/thumbnails/thumb_close_up_front_pine_06.jpg" itemprop="thumbnail" alt="Close up Pine 64 FRONT" />
  </a>


  <figcaption itemprop="caption description">
    Close up Pine 64 FRONT
    <span itemprop="copyrightHolder">Dieter Reuter</span>
  </figcaption>
</figure>




<figure itemscope itemtype="http://schema.org/ImageObject">
  <a href="/images/pine-a64-gallery/close_up_back_pine_05.jpg" itemprop="contentUrl" data-size="1000x664">
      <img src="/images/pine-a64-gallery/thumbnails/thumb_close_up_back_pine_05.jpg" itemprop="thumbnail" alt="Close up Pine 64 BACK" />
  </a>


  <figcaption itemprop="caption description">
    Close up Pine 64 BACK
    <span itemprop="copyrightHolder">Dieter Reuter</span>
  </figcaption>
</figure>




<figure itemscope itemtype="http://schema.org/ImageObject">
  <a href="/images/pine-a64-gallery/close_up_pine_01.jpg" itemprop="contentUrl" data-size="1000x664">
      <img src="/images/pine-a64-gallery/thumbnails/thumb_close_up_pine_01.jpg" itemprop="thumbnail" alt="Close up 01" />
  </a>


  <figcaption itemprop="caption description">
    Close up 01
    <span itemprop="copyrightHolder">Docker Inc.</span>
  </figcaption>
</figure>




<figure itemscope itemtype="http://schema.org/ImageObject">
  <a href="/images/pine-a64-gallery/close_up_pine_02.jpg" itemprop="contentUrl" data-size="1000x664">
      <img src="/images/pine-a64-gallery/thumbnails/thumb_close_up_pine_02.jpg" itemprop="thumbnail" alt="Close up 02" />
  </a>


  <figcaption itemprop="caption description">
    Close up 02
    <span itemprop="copyrightHolder">Dieter Reuter</span>
  </figcaption>
</figure>




<figure itemscope itemtype="http://schema.org/ImageObject">
  <a href="/images/pine-a64-gallery/close_up_pine_03.jpg" itemprop="contentUrl" data-size="1000x664">
      <img src="/images/pine-a64-gallery/thumbnails/thumb_close_up_pine_03.jpg" itemprop="thumbnail" alt="Close up 03" />
  </a>


  <figcaption itemprop="caption description">
    Close up 03
    <span itemprop="copyrightHolder">Dieter Reuter</span>
  </figcaption>
</figure>




<figure itemscope itemtype="http://schema.org/ImageObject">
  <a href="/images/pine-a64-gallery/close_up_pine_04.jpg" itemprop="contentUrl" data-size="1000x664">
      <img src="/images/pine-a64-gallery/thumbnails/thumb_close_up_pine_04.jpg" itemprop="thumbnail" alt="Close up 04" />
  </a>


  <figcaption itemprop="caption description">
    Close up 04
    <span itemprop="copyrightHolder">Dieter Reuter</span>
  </figcaption>
</figure>




<figure itemscope itemtype="http://schema.org/ImageObject">
  <a href="/images/pine-a64-gallery/comparison_to_other_boards.jpg" itemprop="contentUrl" data-size="1000x664">
      <img src="/images/pine-a64-gallery/thumbnails/thumb_comparison_to_other_boards.jpg" itemprop="thumbnail" alt="The Pine A64 compared to a Raspberry Pi 2 and an ODroid C1" />
  </a>


  <figcaption itemprop="caption description">
    The Pine A64 compared to a Raspberry Pi 2 and an ODroid C1
    <span itemprop="copyrightHolder">Dieter Reuter</span>
  </figcaption>
</figure>


</div>
</p>

<p><link rel="stylesheet" href="/css/photoswipe.css">
<link rel="stylesheet" href="/css/default-skin/default-skin.css">
<script src="/js/photoswipe.min.js"></script>
<script src="/js/photoswipe-ui-default.min.js"></script>
<script src="/js/initphotoswipe.js"></script>



<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


<style>
    .gallery {  }
    .gallery img { width: 100%; height: auto; }
    .gallery figure { display: block; float: left; margin: 0 5px 5px 0; width: 200px; }
    .gallery figcaption { display: none; }
    .gallery div.title { font-weight: bold; }
    span[itemprop="copyrightHolder"] { color : #888; float: right; }
    span[itemprop="copyrightHolder"]:before { content: "Foto: "; }
    img[itemprop="thumbnail"]{ width: 200px; }
</style>


<script>initPhotoSwipeFromDOM('.gallery');</script>
</p>

<h2 id="the-software:7983295b98b0feead04ba41a7de6ce9d">The Software</h2>

<p>One of the current limitations of the Pine A64 is that it only runs with Android.
The Pine makers assured us that Linux support will come, too. Still for us it is a tad annoying that Android is first instead of Linux.</p>

<p>Impatient as we are, once we got the device, we immediately started out to rectify this by getting HypriotOS to run on it.
Relatively soon it became obvious that this would not be an easy task.</p>

<p>Why? Well, it seems that the relationship between <a href="http://www.allwinnertech.com/index.html">Allwinner Technology</a> and the Open-Source community has not always been the best in the past.
That basically meant that the existing <a href="http://linux-sunxi.org/">friendly and supportive Open-Source community</a> for the Allwinner related SoC&rsquo;s often had to work
with limited information and support when they tried to come up with proper Linux support for Allwinner based devices.
Still despite that some members of the Linux Sunxi Community are already busy working with the Pine A64.</p>

<h2 id="a-long-journey-down-the-rabbit-hole-begins-with-the-first-step:7983295b98b0feead04ba41a7de6ce9d">A long journey (down the rabbit hole) begins with the first step</h2>

<p>The rest of this blog post describes our preliminary journey to create Linux &amp; Docker bliss for the Pine A64.
And consider yourself sufficiently warned - this journey is not for the faint of heart&hellip; :)</p>

<h3 id="down-the-rabbit-hole-output-foo-with-the-uart0-console:7983295b98b0feead04ba41a7de6ce9d">Down the rabbit hole: Output foo with the UART0 console</h3>

<p>So let&rsquo;s get our hands on this new beauty. First thing you should know is how you can power the Pine A64 board.
It has a standard microUSB port, which you can use with a power adapter of 5V/2A. That&rsquo;s the same you might use for a Raspberry Pi.</p>

<p>For our first low-level steps with the board we prefer to connect to the UART0 console via an UART-to-USB connector cable.
We recommend to use one such as the <a href="https://www.adafruit.com/product/954">USB to TTL Serial Cable</a> from Adafruit.
Adafruit also has a <a href="https://learn.adafruit.com/adafruits-raspberry-pi-lesson-5-using-a-console-cable">great tutorial</a> on how to install the drivers for such a cable on different operating systems.</p>

<p>For connecting via UART0 to the Pine there are basically two ways. Either via the pins of the <code>Euler bus</code> or via the <code>EXT</code> connectors.
The location of each can be seen on the following images. Consult the <a href="http://linux-sunxi.org/Pine64#Serial_port_.2F_UART">Linux-sunxi Wiki: Serial port / UART</a> for more details.</p>

<p>Serial Console with Euler Bus:</p>

<p><img src="/images/pine-a64/serial_euler.jpg" alt="" /></p>

<p>Serial Console with Ext connector:</p>

<p><img src="/images/pine-a64/serial_ext.jpg" alt="" /></p>

<p>To actually work with the UART0 console you have to connect the UART-to-USB cable to your Linux or Mac computer and start your preferred terminal program.</p>

<p>Here is the command for Mac OS X:</p>

<pre><code>$ sudo screen /dev/cu.usbserial 115200
</code></pre>

<p>Don&rsquo;t be surprised that there is absolutely no sign of booting on your console screen when you connect the UART-to-USB cable to the Pine.
The only thing you will see is that the power LED on the board has turned green.</p>

<p>This is due to the fact that the A64 SOC is reading its initial bootloader from the microSD card into memory and starts it.
Among other things this initializes the UART0 port and prints out the first boot messages.</p>

<p>There might be two reasons if your Pine stays silent: either there is no SD card present or there is no working bootloader program found on the SD card.</p>

<p>So let&rsquo;s make sure that we have both.</p>

<p>Grab a working SD card and flash an appropriate image on it.
Thanks to Andre Przywara there already is <a href="https://github.com/apritzel/pine64">a first experimental Linux image</a> that we can use.</p>

<pre><code># replace sdx with the name of your SD card device file

$ xzcat pine64_linux-20160121.img.xz | dd of=/dev/sdx bs=1M
$ sync
</code></pre>

<p>This SD card image is a hybrid that combines components from the original Pine 64 Android image with a recent Linux 4.4.0-rc8 kernel and initrd.
All this is more or less just cobbled together to get a first prototypical SD card image with Linux running.</p>

<p>As this image does not include a full root file system one of the first ideas that came to our mind was to include our HypriotOS root filesystem for ARM64.
Alright, lets see if this really works.</p>

<p>Inserting the SD card into the Pine A64 and booting produced the expected boot messages.
After some seconds the following boot Linux prompt was visible:</p>

<pre><code>BusyBox v1.22.1 (Debian 1:1.22.0-9+deb8u1) built-in shell (ash)
Enter 'help' for a list of built-in commands.

/ #
/ #
/ #
/ # uname -a
Linux (none) 4.4.0-rc8 #20 SMP PREEMPT Mon Jan 18 01:05:25 GMT 2016 aarch64 GNU/Linux
/ # df -h
Filesystem                Size      Used Available Use% Mounted on
none                     78.5M     72.0K     78.4M   0% /run
devtmpfs                381.8M         0    381.8M   0% /dev
/ #
</code></pre>

<p>Okay, that was the first step, but now we would like to see, if it&rsquo;s really possible to boot into a HypriotOS root filesystem.
So let&rsquo;s reboot the Pine. As soon as the U-Boot messages appear, hit a random key to stop the automatic boot process.
This drops us into an interactive U-Boot prompt.</p>

<p>Next we just have to follow Andre&rsquo;s documentation and tell U-Boot to boot into the root filesystem on <code>/dev/sda10</code>, which contains our <a href="https://github.com/hypriot/os-rootfs/releases/tag/v0.6.0">generic HypriotOS for ARM64</a>:</p>

<pre><code>sunxi# run load_env
sunxi# run load_dtb
sunxi# run set_cmdline
sunxi# setenv kernel_part mainline
sunxi# run load_kernel
sunxi# run boot_kernel
</code></pre>

<p>Bingo! It works.</p>

<p><img src="/images/pine-a64/hypriotos_pine64.jpg" alt="" /></p>

<p>Here are a few snippets of the boot log from the UART0 console.
We have stored the complete boot log for you as a <a href="https://gist.github.com/DieterReuter/93a5d10dae6a62911b71">GitHub gist</a>.</p>

<pre><code>HELLO! BOOT0 is starting!
boot0 commit : 045061a8bb2580cb3fa02e301f52a015040c158f

boot0 version : 4.0.0
set pll start
set pll end
...
NOTICE:  BL3-1: v1.0(debug):045061a
NOTICE:  BL3-1: Built : 14:30:28, Dec  3 2015
NOTICE:  BL3-1 commit: 045061a8bb2580cb3fa02e301f52a015040c158f

INFO:    BL3-1: Initializing runtime services
INFO:    BL3-1: Preparing for EL3 exit to normal world
INFO:    BL3-1: Next image address = 0x4a000000
INFO:    BL3-1: Next image spsr = 0x1d3


U-Boot 2014.07 (Dec 03 2015 - 14:30:33) Allwinner Technology
...
Starting kernel ...

INFO:    BL3-1: Next image address = 0x41080000
INFO:    BL3-1: Next image spsr = 0x3c5
Booting Linux on physical CPU 0x0
Initializing cgroup subsys cpu
Linux version 4.4.0-rc8 (aprzywara@slackpad) (gcc version 4.9.3 (GCC) ) #21 SMP PREEMPT Wed Jan 20 22:43:20 GMT 2016
Boot CPU: AArch64 Processor [410fd034]
...
Welcome to Debian GNU/Linux 8 (jessie)!
...
[  OK  ] Reached target Multi-User System.
[  OK  ] Reached target Graphical Interface.

Debian GNU/Linux 8 black-pearl ttyS0

black-pearl login: pirate
Password:
Linux black-pearl 4.4.0-rc8 #21 SMP PREEMPT Wed Jan 20 22:43:20 GMT 2016 aarch64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
HypriotOS/arm64: pirate@black-pearl in ~
$ uname -a
Linux black-pearl 4.4.0-rc8 #21 SMP PREEMPT Wed Jan 20 22:43:20 GMT 2016 aarch64 GNU/Linux
$ cat /etc/os-release
PRETTY_NAME=&quot;Debian GNU/Linux 8 (jessie)&quot;
NAME=&quot;Debian GNU/Linux&quot;
VERSION_ID=&quot;8&quot;
VERSION=&quot;8 (jessie)&quot;
ID=debian
HOME_URL=&quot;http://www.debian.org/&quot;
SUPPORT_URL=&quot;http://www.debian.org/support/&quot;
BUG_REPORT_URL=&quot;https://bugs.debian.org/&quot;
HYPRIOT_OS=&quot;HypriotOS/arm64&quot;
HYPRIOT_TAG=&quot;dirty&quot;
HypriotOS/arm64: root@black-pearl in ~
</code></pre>

<p><strong>Success!</strong> The first boot of HypriotOS/arm64 on a Pine A64 board.</p>

<h3 id="even-deeper-into-the-rabbit-hole-using-the-fel-mode-to-communicate-with-the-the-pine-a64:7983295b98b0feead04ba41a7de6ce9d">Even deeper into the rabbit hole: Using the FEL mode to communicate with the the Pine A64</h3>

<p>OK. That was fun, wasn&rsquo;t it? Our small experiment with the UART-to-USB connector cable and the SD card image from Andre did give us a first taste of Linux on the Pine.
But that of course is not the real deal. There is still a rocky path to walk before we will have proper Linux support.</p>

<p>Our path towards more knowledge leads us even deeper into the rabbit hole.</p>

<p>In order to gain that deeper knowledge we will introduce you to another powerful tool called <a href="http://linux-sunxi.org/FEL">FEL</a> mode.
The FEL mode is a low-level subroutine in the Boot ROM of all Allwinner devices that can be used to gather valuable insights about the Pine.
We will show you shortly how this works.</p>

<p>Besides gathering intel FEL has another useful application. It allows you to directly boot images via an USB cable from your development computer.
As such it makes the annoying process of flashing and inserting SD cards over and over again obsolete.</p>

<p>Booting the Pine A64 into FEL mode is really easy. Just leave the SD card slot empty and connect the Pine A64 with an appropriate USB cable  to your computer.
Then power on the Pine. It&rsquo;s important to know that you have to connect to the Pine with a special USB cable to the upper USB port.
That is because only this USB port is wired for using the FEL signals.</p>

<p><img src="/images/pine-a64/upper_usb_port.jpg" alt="" /></p>

<p>You can buy such a special USB A-male/A-male cable at <a href="http://www.amazon.com/Monoprice-1-5-Feet-24AWG-Plated-105441/dp/B009GUXG92">Amazon</a> or <a href="http://www.instructables.com/id/Male-to-Male-A-to-A-USB-Cable/">build it on your own</a>.
Once the Pine A64 is booted, it can be discovered on your host computer as a new USB device with the <code>USB ID 1f3a:efe8</code>.</p>

<p>Running <code>lsusb</code> should show the device:</p>

<pre><code>$ lsusb
Bus 001 Device 004: ID 1f3a:efe8
</code></pre>

<p>For further access via FEL mode, we need to install and compile the very latest version of the sunxi-tools.
As our development computer we are using a Raspberry Pi running <a href="http://blog.hypriot.com/post/just-in-time-for-DockerCon-EU-a-shipload-of-new-Docker-ARM-goodies/">HypriotOS</a>.
So let&rsquo;s install all the development dependencies we need and then clone the sunxi-tools repo and compile them from source.</p>

<pre><code>$ sudo apt-get update
$ sudo apt-get install -y make gcc pkg-config libusb-1.0-0-dev
$ makedir -p ~/code
$ cd ~/code
$ git clone https://github.com/linux-sunxi/sunxi-tools
$ cd sunxi-tools
$ make
$ sudo make install
</code></pre>

<p>Now let&rsquo;s see if we can use the sunxi-tools to extract some version information about the Pine.</p>

<pre><code>$ sudo sunxi-fel version
AWUSBFEX soc=00001689(unknown) 00000001 ver=0001 44 08 scratchpad=00017e00 00000000 00000000
</code></pre>

<p>Bingo! The Pine A64 board is connected and we are already getting some basic version info.
The the SOC ID #1689 tells us it is an Allwinner A64 SOC.
The device itself is classified as &ldquo;unknown&rdquo; because it is too new to be recognized by the <code>sunxi-fel</code> tool.</p>

<p>What can we do now with this low-level access via FEL mode?</p>

<p>Well, for instance we could read 128 bytes of the device memory and display it as hex dump on the screen.
Let&rsquo;s start from address 0x0000:</p>

<pre><code>$ sudo sunxi-fel hexdump 0x0000 128
00000000: 08 00 00 ea 06 00 00 ea 05 00 00 ea 04 00 00 ea  ................
00000010: 03 00 00 ea 02 00 00 ea 11 00 00 ea 00 00 00 ea  ................
00000020: 13 00 00 ea fe ff ff ea 01 00 a0 e3 00 10 a0 e3  ................
00000030: 00 20 a0 e3 00 30 a0 e3 00 40 a0 e3 00 50 a0 e3  . ...0...@...P..
00000040: 00 60 a0 e3 00 70 a0 e3 00 80 a0 e3 00 90 a0 e3  .`...p..........
00000050: 00 a0 a0 e3 00 b0 a0 e3 00 c0 a0 e3 00 d0 a0 e3  ................
00000060: e8 f0 9f e5 04 e0 4e e2 ff 5f 2d e9 1f 07 00 eb  ......N.._-.....
00000070: ff 9f fd e8 d2 20 a0 e3 02 f0 21 e1 d0 d0 9f e5  ..... ....!.....
</code></pre>

<p>Or we could just copy the device memory into a file to our development computer and display the content with the <code>hexdump</code> command locally.</p>

<pre><code>$ sudo sunxi-fel dump 0x0000 128 &gt; memory-dump.bin
$ hexdump -C memory-dump.bin
00000000  08 00 00 ea 06 00 00 ea  05 00 00 ea 04 00 00 ea  |................|
00000010  03 00 00 ea 02 00 00 ea  11 00 00 ea 00 00 00 ea  |................|
00000020  13 00 00 ea fe ff ff ea  01 00 a0 e3 00 10 a0 e3  |................|
00000030  00 20 a0 e3 00 30 a0 e3  00 40 a0 e3 00 50 a0 e3  |. ...0...@...P..|
00000040  00 60 a0 e3 00 70 a0 e3  00 80 a0 e3 00 90 a0 e3  |.`...p..........|
00000050  00 a0 a0 e3 00 b0 a0 e3  00 c0 a0 e3 00 d0 a0 e3  |................|
00000060  e8 f0 9f e5 04 e0 4e e2  ff 5f 2d e9 1f 07 00 eb  |......N.._-.....|
00000070  ff 9f fd e8 d2 20 a0 e3  02 f0 21 e1 d0 d0 9f e5  |..... ....!.....|
00000080
</code></pre>

<p>As we already explained, the Allwinner SOC is starting it&rsquo;s boot process by loading the Boot ROM (<a href="http://linux-sunxi.org/BROM">BROM</a>)
and detects wether it should run a normal boot or start the FEL subroutine.
With the help of FEL mode and the <code>sunxi-fel</code> tool we can also copy and analyze the BROM boot code itself.</p>

<p>So, let&rsquo;s download the BROM directly from the Pine and save it into a local file on our development computer for later inspection.
In order to do so, we need to know the memory address where the BROM starts.</p>

<p>Unfortunately the memory address that works for existing Allwinner SoC&rsquo;s like the A10 or A20 does not work here.
But there is an important clue in the <a href="http://linux-sunxi.org/EGON">Linux-Sunxi wiki</a> that tells us
that we need to search for a unique string <code>eGON.BRM</code> near the starting address of the BROM.</p>

<p>Armed with this knowledge and the <code>sunxi-fel hexdump</code> command we can now scan the memory until we will find this string.
And luckily we were able to locate the BROM starting at address <strong>0x2c00</strong>:</p>

<pre><code>$ sudo sunxi-fel hexdump 0x2c00 128
00002c00: 07 00 00 ea 07 00 00 ea 65 47 4f 4e 2e 42 52 4d  ........eGON.BRM
00002c10: 24 00 00 00 31 31 30 30 31 31 30 30 31 36 33 33  $...110011001633
00002c20: 00 00 00 00 00 00 00 ea 01 00 00 ea 00 60 a0 e3  .............`..
00002c30: 03 00 00 ea 5c 60 a0 e3 0e 00 00 ea e8 01 9f e5  ....\`..........
00002c40: 00 f0 90 e5 b0 0f 10 ee 03 10 00 e2 00 00 51 e3  ..............Q.
00002c50: f9 ff ff 1a ff 1c 00 e2 00 00 51 e3 f6 ff ff 1a  ..........Q.....
00002c60: c8 11 9f e5 c8 21 9f e5 00 30 91 e5 03 00 52 e1  .....!...0....R.
00002c70: 00 00 00 1a f0 ff ff ea 50 00 a0 e3 01 00 50 e2  ........P.....P.
</code></pre>

<p>Now let&rsquo;s download the complete 32 KByte of the BROM binary blob and have a look at it:</p>

<pre><code>$ sudo sunxi-fel dump 0x2c00 32768 &gt; pine64-a64-brom.bin
$ head -c 128 pine64-a64-brom.bin | hexdump -C
00000000  07 00 00 ea 07 00 00 ea  65 47 4f 4e 2e 42 52 4d  |........eGON.BRM|
00000010  24 00 00 00 31 31 30 30  31 31 30 30 31 36 33 33  |$...110011001633|
00000020  00 00 00 00 00 00 00 ea  01 00 00 ea 00 60 a0 e3  |.............`..|
00000030  03 00 00 ea 5c 60 a0 e3  0e 00 00 ea e8 01 9f e5  |....\`..........|
00000040  00 f0 90 e5 b0 0f 10 ee  03 10 00 e2 00 00 51 e3  |..............Q.|
00000050  f9 ff ff 1a ff 1c 00 e2  00 00 51 e3 f6 ff ff 1a  |..........Q.....|
00000060  c8 11 9f e5 c8 21 9f e5  00 30 91 e5 03 00 52 e1  |.....!...0....R.|
00000070  00 00 00 1a f0 ff ff ea  50 00 a0 e3 01 00 50 e2  |........P.....P.|
00000080
</code></pre>

<p>All these examples were based on the FEL mode and the <code>sunxi-fel</code> tool.
They illustrated how to gather information about a device.</p>

<p>In the introduction about the FEL mode we did mention another application of the FEL mode: You can have a faster development cycle where one does not have to flash and boot SD cards.</p>

<p>To make this mode work for the Pine we first have to patch the <code>sunix-fel</code> tool.
Thanks to the work of <a href="https://github.com/ssvb">Siarhei Siamashka</a> from Linux-Sunxi community this is easy:</p>

<pre><code>$ cd ~/code/sunxi-tools
$ mv fel.c fel.c.org
$ wget https://github.com/ssvb/sunxi-tools/raw/dc77476014669a6f9010a3160357391450a5196e/fel.c
$ make
$ sudo make install
</code></pre>

<p>Wow, it works. The <code>sunxi-fel</code> tool now correctly detects the Pine A64 and the Allwinner A64 SOC.</p>

<pre><code>$ sudo sunxi-fel version
AWUSBFEX soc=00001689(A64) 00000001 ver=0001 44 08 scratchpad=00017e00 00000000 00000000
</code></pre>

<p>With this preparation in place our work on things like the Secondary Program Loader (SPL or boot0), U-Boot, the Linux kernel and its modules get much more convenient.</p>

<p><img src="/images/pine-a64/dev-host-pine-cabeling.jpg" alt="" /></p>

<h3 id="inside-wonderland-combining-uart0-console-and-fel-mode:7983295b98b0feead04ba41a7de6ce9d">Inside wonderland: Combining UART0 console and FEL mode</h3>

<p>Now it is time to put the various things together we have learned thus far.
Using both an USB A-male/A-male cable and an UART-to-USB connector cable at the same time we are able to send software to the Pine and see how it gets executed.
This allows for fast feedback cycles.</p>

<p>We will attempt this by uploading and starting a boot0 bootloader.</p>

<p>Instead of creating our own boot0 bootloader for the sake of simplicity we are going to extract the existing one from Andre&rsquo;s Linux SD card image.
It is located at sector 16 (or 8 KByte) and has a total size of 64 sectors or 32 KByte.</p>

<pre><code>$ xzcat pine64_linux-20160121.img.xz | dd of=pine64-boot0.bin bs=512 count=64 skip=16
</code></pre>

<p>Let&rsquo;s double-check if this file is really the correct boot0 binary blob we&rsquo;re looking for.
The file should start with the string &ldquo;eGON.BT0&rdquo; at byte #5. Here we are:</p>

<pre><code>$ hexdump -C pine64-boot0.bin
00000000  cc 00 00 ea 65 47 4f 4e  2e 42 54 30 31 7a f6 a8  |....eGON.BT01z..|
00000010  00 80 00 00 30 00 00 00  00 00 00 00 00 00 01 00  |....0...........|
00000020  00 00 01 00 00 00 00 00  00 00 34 2e 30 2e 30 00  |..........4.0.0.|
00000030  00 00 00 00 01 00 00 00  a0 02 00 00 03 00 00 00  |................|
...
</code></pre>

<p>With the help of <code>sunxi-fel</code> this boot0 program can now be sent directly to the Pine A64.</p>

<pre><code>$ sudo sunxi-fel spl pine64-boot0.bin
</code></pre>

<p>Looking at our UART0 console output we can see that the upload and start of the program works as expected.</p>

<pre><code>HELLO! BOOT0 is starting!
boot0 commit : 045061a8bb2580cb3fa02e301f52a015040c158f

boot0 version : 4.0.0
set pll start
set pll end
rtc[0] value = 0x00000000
rtc[1] value = 0x00000000
rtc[2] value = 0x00000000
rtc[3] value = 0x00000000
rtc[4] value = 0x00000000
rtc[5] value = 0x00000000
DRAM driver version: V1.1
rsb_send_initseq: rsb clk 400Khz -&gt; 3Mhz
PMU: AXP81X
ddr voltage = 1500 mv
DRAM Type = 3 (2:DDR2,3:DDR3,6:LPDDR2,7:LPDDR3)
DRAM clk = 672 MHz
DRAM zq value: 003b3bbb
DRAM single rank full DQ OK
DRAM size = 1024 MB
DRAM init ok
dram size =1024
card boot number = 0, boot0 copy = 0
card no is 0
sdcard 0 line count 4
[mmc]: mmc driver ver 2015-05-08 20:06
[mmc]: sdc0 spd mode error, 2
[mmc]: Wrong media type 0x00000000
[mmc]: ***Try SD card 0***
[mmc]: mmc 0 cmd 8 timeout, err 00000100
[mmc]: mmc 0 cmd 8 err 00000100
[mmc]: mmc 0 send if cond failed
[mmc]: mmc 0 cmd 55 timeout, err 00000100
[mmc]: mmc 0 cmd 55 err 00000100
[mmc]: mmc 0 send app cmd failed
[mmc]: ***Try MMC card 0***
[mmc]: mmc 0 cmd 1 timeout, err 00000100
[mmc]: mmc 0 cmd 1 err 00000100
[mmc]: mmc 0 send op cond failed
[mmc]: mmc 0 Card did not respond to voltage select!
[mmc]: ***SD/MMC 0 init error!!!***
[mmc]: mmc 0 register failed
Fail in Init sdmmc.
Ready to disable icache.
</code></pre>

<p>By verifying that we can send code to the Pine and execute it, we opened up the door for further steps.
For instance working on a new U-Boot bootloader.</p>

<p>A few days ago Siarhei was able to create a first working U-Boot for the A64 SOC and could upload and start it on his Pine A64 board.
He published the full boot log of this <a href="https://gist.github.com/ssvb/67ebb38e8f8f2b9b5ee6">work-in-progress U-Boot bootloader</a>.</p>

<p>Here you can see a snippet from the boot log that shows what is already working:</p>

<pre><code>U-Boot SPL 2016.01-00352-ge77e0e4-dirty (Jan 24 2016 - 10:26:33)
DRAM:DRAM driver version: V1.0
DRAM Type = 3 (2:DDR2,3:DDR3,6:LPDDR2,7:LPDDR3)
DRAM clk = 672 MHz
DRAM zq value: 3b3bbb
DRAM single rank full DQ OK
DRAM size = 1024 MB
DRAM init ok
 1024 MiB
Trying to boot from MMC


U-Boot 2016.01-00352-ge77e0e4-dirty (Jan 24 2016 - 10:26:33 +0200) Allwinner Technology

CPU:   Allwinner A64 (SUN50I)
DRAM:  1 GiB
MMC:   SUNXI SD/MMC: 0
...
</code></pre>

<h2 id="the-preliminary-end:7983295b98b0feead04ba41a7de6ce9d">The preliminary end</h2>

<p>This brings us (somewhat sadly) to the end of our blog post.</p>

<p>Our goal was to give a first impression of the current state of Linux support for the Pine A64.
And we also wanted to give you an introduction to the tools and knowledge that are necessary to make it happen.</p>

<p>This blogpost would not be possible without the great guys from the Linux-Sunxi community.
Especially the help of <a href="https://github.com/apritzel">Andre Przywara</a> (apritzel) and <a href="https://github.com/ssvb">Siarhei Siamashka</a> (ssvb) was invaluable.
It demands lots of respect seeing how they have to reverse engineer this stuff with only little support from Allwinner Technology.
We really hope that the <a href="http://forum.pine64.org/forumdisplay.php?fid=17">announced support</a> from the Pine team will help to move things forward.</p>

<p>We will follow this development closely and hope to publish an initial support for HypriotOS rather sooner than later.
By this Docker will gain access to a really powerful developer board - and we will support it early on.</p>

<p>We hope you enjoyed this whirlwind tour through the Pine Linux Wonderland!</p>

<p>As always, use the comments below to give us feedback, discuss this post on <a href="https://news.ycombinator.com/item?id=10973751">HackerNews</a> and share this post on Twitter, Google or Facebook.</p>

<p>Dieter <a href="https://twitter.com/Quintus23M">@Quintus23M</a> and Govinda <a href="https://twitter.com/_beagile_">@_beagile_</a></p>

    <div class="social-sharing">
  
<div class="social-sharing-twitter" style="float: left;">
  <a class="twitter-share-button"
    href="https://twitter.com/share"
    data-url="http://localhost:1313/post/the-pine-a64-is-about-to-become=the-cheapest-ARM-64-bit-platform-to-run-Docker/"
    data-lang="en"
    data-show-count="true"
    data-via="HypriotTweets">
  Tweet
  </a>
  <script>
  window.twttr=(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);t._e=[];t.ready=function(f){t._e.push(f);};return t;}(document,"script","twitter-wjs"));
  </script>
</div>

  
<div class="social-sharing-facebook" style="float: left;">
  <div id="fb-root"></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.5&appId=599115553447708";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));</script>
  <div class="fb-share-button" data-href="http://localhost:1313/post/the-pine-a64-is-about-to-become=the-cheapest-ARM-64-bit-platform-to-run-Docker/" data-layout="button_count"></div>
</div>

  
<div class="social-sharing-google">
  <script >
    window.___gcfg = {
      lang: 'en-US',
      parsetags: 'onload'
    };
  </script>
  <script src="https://apis.google.com/js/platform.js" async defer></script>
  <div class="g-plus" data-action="share" data-annotation="bubble" data-width="200" data-href="http://localhost:1313/post/the-pine-a64-is-about-to-become=the-cheapest-ARM-64-bit-platform-to-run-Docker/"></div>
</div>

</div>

    <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'hypriot';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  </div>
</div>

<script data-no-instant>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>
